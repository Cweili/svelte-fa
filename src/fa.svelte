<script>
let clazz = '';
export { clazz as class };
export let id = '';
export let style = '';

export let icon;

export let size = '';
export let color = '';

export let fw = false;
export let pull = '';

export let scale = 1;
export let translateX = 0;
export let translateY = 0;
export let rotate = '';
export let flip = false;

export let spin = false;
export let pulse = false;

// Duotone Icons
export let primaryColor = '';
export let secondaryColor = '';
export let primaryOpacity = 1;
export let secondaryOpacity = 0.4;
export let swapOpacity = false;

let i;
let s;
let c;
let transform;

$: i = (icon && icon.icon) || [0, 0, '', [], ''];

$: c = [
  clazz,
  spin && 'spin',
  pulse && 'pulse',
]
  .filter((cls) => cls)
  .join('');

$: {
  let float;
  let width;
  const height = '1em';
  let lineHeight;
  let fontSize;
  let textAlign;
  let verticalAlign = '-.125em';
  const overflow = 'visible';

  if (fw) {
    textAlign = 'center';
    width = '1.25em';
  }

  if (pull) {
    float = pull;
  }

  if (size) {
    if (size == 'lg') {
      fontSize = '1.33333em';
      lineHeight = '.75em';
      verticalAlign = '-.225em';
    } else if (size == 'xs') {
      fontSize = '.75em';
    } else if (size == 'sm') {
      fontSize = '.875em';
    } else {
      fontSize = size.replace('x', 'em');
    }
  }

  const styleObj = {
    float,
    width,
    height,
    'line-height': lineHeight,
    'font-size': fontSize,
    'text-align': textAlign,
    'vertical-align': verticalAlign,
    overflow,
  };
  let styleStr = '';
  for (const prop in styleObj) {
    if (styleObj[prop]) {
      styleStr += `${prop}:${styleObj[prop]};`;
    }
  }
  s = styleStr + style;
}

$: {
  const float = parseFloat;
  let t = `translate(${float(translateX) * 512} ${float(translateY) * 512})`;
  let flipX = 1;
  let flipY = 1;

  if (flip) {
    if (flip == 'horizontal') {
      flipX = -1;
    } else if (flip == 'vertical') {
      flipY = -1;
    } else {
      flipX = flipY = -1;
    }
  }

  t += ` scale(${flipX * float(scale)} ${flipY * float(scale)})`;

  if (rotate) {
    t += ` rotate(${rotate} 0 0)`;
  }

  transform = t;
}
</script>

<style>
.spin {
  animation: spin 2s 0s infinite linear;
}

.pulse {
  animation: spin 1s infinite steps(8);
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
</style>

{#if i[4]}
  <svg
    {id}
    class={c}
    style={s}
    viewBox={`0 0 ${i[0]} ${i[1]}`}
    aria-hidden="true"
    role="img"
    xmlns="http://www.w3.org/2000/svg"
  >
    <g
      transform="translate(256 256)"
    >
      <g {transform}>
        {#if typeof i[4] == 'string'}
          <path
            d={i[4]}
            fill={color || primaryColor || 'currentColor'}
            transform="translate(-256 -256)"
          />
        {:else}
          <path
            d={i[4][0]}
            fill={secondaryColor || color || 'currentColor'}
            fill-opacity={swapOpacity != false ? primaryOpacity : secondaryOpacity}
            transform="translate(-256 -256)"
          />
          <path
            d={i[4][1]}
            fill={primaryColor || color || 'currentColor'}
            fill-opacity={swapOpacity != false ? secondaryOpacity : primaryOpacity}
            transform="translate(-256 -256)"
          />
        {/if}
      </g>
    </g>
  </svg>
{/if}
